# Решение бизнес-задач с помощью SQL

``` Учебный проект ``` 


## Легенда 

Компания Pens and Pencils. Базируется в США и там же осуществляет свою деятельность. С марта 2017 года её профиль — B2B и B2C-продажи офисных товаров (оргтехника, канцтовары и мебель) онлайн. 

## Цель проекта

Проанализировать работу компании с точки зрения эффективности и дать рекомендации по масштабированию бизнеса, а именно в каком штате лучше открыть офлайн-магазин.

## Формализированные задачи

- Оценить динамику продаж и распределение выручки по товарам.
- Составить портрет клиента, а для этого — выяснить, какие клиенты приносят больше всего выручки.
- Проконтролировать логистику компании (определить, все ли заказы доставляются в срок и в каком штате лучше открыть офлайн-магазин).


## Как посмотреть проект

[Ссылка](https://docs.google.com/document/d/1nAMG5xN4FBDZlnyWf4gpsjNhmLWO8gac3wcHfqgQ5lQ/edit?usp=sharing) на гугл документ.

## Структура проекта

- Динамика продаж

- Продажи по категориям товаров

- Портрет клиента

- Логистика компании

- Где открыть еще один склад

## Ключевые инструменты
```
- SQL
- Metabase
```

## Использованные методы
```
- Сегментация, Портрет клиента
- SQL: джойны, CTE, оконные функции, условные функции
- Визулизация в Metabase
```


## Реализация в скриншотах

![Пример кода](/code_pic.png)

![Скриншот визулизации продаж по категориям товаров](/categories.png)

![Скриншот визуализации динамики появления новых корпоративных клиентов](/new_B2B.png)

![Скриншот визуализации распределения доставок](/map.png)

![Портрет клиента](/typical_client.png)


## Пример кода (текст)
```
with order_rank as -- создаем CTE, где пронумеруем заказы клиентов в хронологическом порядке
(
  select 
    date_trunc('month', order_date):: date as month, 
    -- округляем order_date до месяца, присваиваем тип date 
    d.cust_id, 
    ROW_NUMBER() OVER(
      partition by d.cust_id 
      ORDER BY 
        order_date
    ) order_number, 
    -- с помощью оконной функции присваиваем порядковый номер заказа для каждого клиента
    category 
  from 
    sql.store_delivery d -- берем order_date
    join sql.store_customers cust on cust.cust_id = d.cust_id
    -- берем тип клиента category,  идентификатор клиента cust_id
    ) 
select 
  -- создаем запрос, где:
  month, 
  -- в каждом месяце
  count(distinct cust_id) -- считаем количество клиентов
from 
  order_rank 
where 
  order_number = 1 -- для которые купили впервые
  and category = 'Corporate' -- и являются B2B-клиентом
group by 
  1 -- группировка по месяцу продажи 
order by 
  1 -- сортируем в хронологическом порядке

```


